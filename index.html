<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Voice Translator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#0B1220">
  <link rel="manifest" href="manifest.json">

  <style>
    :root{
      --bg1:#0B1220;
      --bg2:#0E1B2E;
      --card: rgba(255,255,255,0.06);
      --stroke: rgba(255,255,255,0.14);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.70);
      --accent:#7C3AED;
      --danger:#EF4444;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:"Segoe UI",Tahoma,sans-serif;
      color:var(--text);
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      padding:18px;
      background:
        radial-gradient(900px 500px at 20% 15%, rgba(124,58,237,.35), transparent 55%),
        radial-gradient(900px 500px at 80% 20%, rgba(34,197,94,.25), transparent 55%),
        linear-gradient(135deg,var(--bg1),var(--bg2));
    }
    .wrap{width:100%;max-width:560px}
    .card{
      background:var(--card);
      border:1px solid var(--stroke);
      border-radius:22px;
      padding:22px;
      box-shadow:0 25px 60px rgba(0,0,0,.45);
      backdrop-filter:blur(10px);
      text-align:center;
      position:relative;
      overflow:hidden;
    }
    .topbar{
      display:grid;
      grid-template-columns: 1fr auto 1fr;
      align-items:center;
      margin-bottom: 10px;
    }
    .logoLeft{
      justify-self:start;
      font-size:30px;
      font-weight:900;
      letter-spacing:2px;
      background:linear-gradient(135deg,#7C3AED,#22C55E);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      user-select:none;
    }
    h1{margin:0;font-size:20px;font-weight:800;justify-self:center}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
    label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
    select,textarea,button{
      width:100%;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(16,23,40,.65);
      color:var(--text);
      padding:12px;
      font-size:15px;
    }
    .boxes{display:grid;gap:10px;margin-top:12px}
    .box{
      min-height:60px;border-radius:16px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      display:flex;align-items:center;justify-content:center;
      padding:12px;text-align:center;word-break:break-word;
      position:relative;overflow:hidden;
    }
    textarea{margin-top:10px;min-height:90px;resize:vertical;text-align:center}
    .btnRow{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
    button{cursor:pointer;font-weight:700;transition:transform .12s ease}
    button:active{transform:scale(.97)}
    button:disabled{opacity:.55;cursor:not-allowed}
    .primary{background:linear-gradient(135deg,var(--accent),#A78BFA);color:#0B1220}
    .secondary{background:rgba(255,255,255,.06)}
    .danger{background:rgba(239,68,68,.15)}
    .hint{margin-top:10px;font-size:12px;color:var(--muted);min-height:18px}

    /* subtle translate loading */
    .loadingPulse::before{
      content:"";
      position:absolute;
      inset:0;
      background: linear-gradient(90deg, transparent, rgba(124,58,237,0.25), transparent);
      transform: translateX(-100%);
      animation: shimmer 1.1s infinite;
    }
    .loadingBadge{
      position:absolute;
      top:10px;
      left:12px;
      font-size:12px;
      color:rgba(255,255,255,0.75);
      display:none;
      align-items:center;
      gap:8px;
      background: rgba(0,0,0,0.18);
      border: 1px solid rgba(255,255,255,0.12);
      padding: 6px 10px;
      border-radius: 999px;
      backdrop-filter: blur(6px);
    }
    .dot{width:8px;height:8px;border-radius:50%;background: rgba(255,255,255,0.75);animation:bounce .9s infinite ease-in-out}
    .dot:nth-child(2){animation-delay:.15s}
    .dot:nth-child(3){animation-delay:.30s}
    @keyframes shimmer{0%{transform:translateX(-120%)}100%{transform:translateX(120%)}}
    @keyframes bounce{0%,100%{transform:translateY(0);opacity:.7}50%{transform:translateY(-4px);opacity:1}}

    @media(max-width:420px){.grid,.btnRow{grid-template-columns:1fr}}
  </style>
</head>
<body>

<div class="wrap">
  <div class="card">

    <div class="topbar">
      <div class="logoLeft">PZ</div>
      <h1>Voice Translator</h1>
      <div></div>
    </div>

    <div class="grid">
      <div>
        <label>Ø²Ø¨Ø§Ù† ÙˆØ±ÙˆØ¯ÛŒ</label>
        <select id="sourceLang"></select>
      </div>
      <div>
        <label>Ø²Ø¨Ø§Ù† Ù…Ù‚ØµØ¯</label>
        <select id="targetLang"></select>
      </div>
    </div>

    <div class="boxes">
      <div class="box" id="originalText">Ù…ØªÙ† ÙˆØ±ÙˆØ¯ÛŒâ€¦</div>

      <div class="box" id="translatedBox">
        <div class="loadingBadge" id="loadingBadge">
          <span>Ø¯Ø±Ø­Ø§Ù„ ØªØ±Ø¬Ù…Ù‡</span>
          <span class="dot"></span><span class="dot"></span><span class="dot"></span>
        </div>
        <div id="translatedText">ØªØ±Ø¬Ù…Ù‡â€¦</div>
      </div>
    </div>

    <textarea id="manualInput" placeholder="Ù…ØªÙ† Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ù†ÙˆÛŒØ³â€¦"></textarea>

    <div class="btnRow">
      <button id="recordBtn" class="primary">ğŸ™ Ø´Ø±ÙˆØ¹ ØµØ­Ø¨Øª</button>
      <button id="translateBtn" class="secondary">ğŸ” ØªØ±Ø¬Ù…Ù‡ Ù…ØªÙ†</button>
    </div>

     <div class="btnRow">
    <button id="playBtn" class="secondary" disabled>ğŸ”Š Ù¾Ø®Ø´ ØªØ±Ø¬Ù…Ù‡</button>
    <button id="clearBtn" class="danger">ğŸ—‘ Ø­Ø°Ù Ù…ØªÙ†</button>
  </div>



    <div class="hint" id="hintText"></div>
  </div>
</div>

<script>
  const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) || (navigator.userAgent.includes("Mac") && "ontouchend" in document);

  const LANGS=[
    {n:"ÙØ§Ø±Ø³ÛŒ",tl:"fa",sl:"fa-IR",rtl:true},
    {n:"English",tl:"en",sl:"en-US"},
    {n:"FranÃ§ais",tl:"fr",sl:"fr-FR"},
    {n:"Deutsch",tl:"de",sl:"de-DE"},
    {n:"EspaÃ±ol",tl:"es",sl:"es-ES"},
    {n:"Italiano",tl:"it",sl:"it-IT"},
    {n:"PortuguÃªs",tl:"pt",sl:"pt-PT"},
    {n:"Î•Î»Î»Î·Î½Î¹ÎºÎ¬",tl:"el",sl:"el-GR"},
    {n:"Ğ ÑƒÑÑĞºĞ¸Ğ¹",tl:"ru",sl:"ru-RU"},
    {n:"TÃ¼rkÃ§e",tl:"tr",sl:"tr-TR"},
    {n:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",tl:"ar",sl:"ar-SA",rtl:true},
    {n:"Ø§Ø±Ø¯Ùˆ",tl:"ur",sl:"ur-PK",rtl:true},
    {n:"à¤¹à¤¿à¤¨à¥à¤¦à¥€",tl:"hi",sl:"hi-IN"},
    {n:"à¦¬à¦¾à¦‚à¦²à¦¾",tl:"bn",sl:"bn-BD"},
    {n:"à¹„à¸—à¸¢",tl:"th",sl:"th-TH"},
    {n:"Tiáº¿ng Viá»‡t",tl:"vi",sl:"vi-VN"},
    {n:"Bahasa Indonesia",tl:"id",sl:"id-ID"},
    {n:"Nederlands",tl:"nl",sl:"nl-NL"},
    {n:"Svenska",tl:"sv",sl:"sv-SE"},
    {n:"Polski",tl:"pl",sl:"pl-PL"},
    {n:"æ—¥æœ¬èª",tl:"ja",sl:"ja-JP"},
    {n:"í•œêµ­ì–´",tl:"ko",sl:"ko-KR"},
    {n:"ä¸­æ–‡",tl:"zh-CN",sl:"zh-CN"}
  ];

  const s=document.getElementById("sourceLang");
  const t=document.getElementById("targetLang");
  const o=document.getElementById("originalText");
  const tr=document.getElementById("translatedText");
  const m=document.getElementById("manualInput");
  const play=document.getElementById("playBtn");
  const stop=document.getElementById("stopBtn");
  const hint=document.getElementById("hintText");

  const translatedBox=document.getElementById("translatedBox");
  const loadingBadge=document.getElementById("loadingBadge");

  LANGS.forEach(l=>{
    s.add(new Option(l.n,l.sl));
    t.add(new Option(l.n,l.tl));
  });
  s.value="fa-IR"; t.value="en";

  function setDir(){
    const src=LANGS.find(x=>x.sl===s.value);
    const tgt=LANGS.find(x=>x.tl===t.value);
    m.style.direction=src?.rtl?"rtl":"ltr";
    o.style.direction=src?.rtl?"rtl":"ltr";
    tr.style.direction=tgt?.rtl?"rtl":"ltr";
  }
  setDir();
  s.onchange=t.onchange=setDir;

  function setLoading(on){
    if(on){
      translatedBox.classList.add("loadingPulse");
      loadingBadge.style.display="inline-flex";
    }else{
      translatedBox.classList.remove("loadingPulse");
      loadingBadge.style.display="none";
    }
  }

  async function translateText(text,tl){
    const r=await fetch(
      `https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${tl}&dt=t&q=${encodeURIComponent(text)}`
    );
    if(!r.ok) throw new Error("Translate failed: " + r.status);
    const j=await r.json();
    return j?.[0]?.[0]?.[0] || "";
  }

  // IMPORTANT: one single function used by BOTH (typing) and (speech)
  let last="";
  async function runTranslate(inputText, fromSpeech=false){
    const text=(inputText||"").trim();
    if(!text){ hint.textContent="Ù…ØªÙ† ÙˆØ§Ø±Ø¯ Ú©Ù†"; return; }

    hint.textContent="";
    o.textContent=text;
    m.value=text;

    setLoading(true);
    try{
      const out=await translateText(text,t.value);
      tr.textContent=out;
      last=out;
      play.disabled=!out;
      stop.disabled=!out;

      // Android/Desktop: auto speak if coming from speech
      if(fromSpeech && !isIOS && out){
        speak(out, t.value);
      } else if(fromSpeech && isIOS){
        hint.textContent="ØªØ±Ø¬Ù…Ù‡ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯ âœ… Ø¨Ø±Ø§ÛŒ ØµØ¯Ø§ Ø±ÙˆÛŒ Â«Ù¾Ø®Ø´ ØªØ±Ø¬Ù…Ù‡Â» Ø¨Ø²Ù†.";
      }
    }catch(e){
      hint.textContent="Ø®Ø·Ø§ Ø¯Ø± ØªØ±Ø¬Ù…Ù‡. Ø§ÛŒÙ†ØªØ±Ù†Øª ÛŒØ§ Ø¯Ø³ØªØ±Ø³ÛŒ Translate Ù…Ø´Ú©Ù„ Ø¯Ø§Ø±Ø¯.";
    }finally{
      setLoading(false);
    }
  }

  function speak(txt,lang){
    try{ speechSynthesis.cancel(); }catch(_){}
    const u=new SpeechSynthesisUtterance(txt);
    u.lang=lang;
    speechSynthesis.speak(u);
  }

  document.getElementById("translateBtn").onclick=()=>runTranslate(m.value,false);

  play.onclick=()=>{ if(last) speak(last,t.value); };
  stop.onclick=()=>{ try{speechSynthesis.cancel();}catch(_){} };

  // SpeechRecognition: NOW it auto-translates after result âœ…
  const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
  if(SR){
    const rec=new SR();
    rec.continuous=false;
    rec.interimResults=false;

    rec.onresult=async(e)=>{
      const text=e.results?.[0]?.[0]?.transcript || "";
      if(!text.trim()) return;
      await runTranslate(text, true); // âœ… auto translate after speech
    };

    rec.onerror=()=>{ hint.textContent="ØªØ´Ø®ÛŒØµ ØµØ¯Ø§ Ù…Ø´Ú©Ù„ Ø¯Ø§Ø±Ø¯. Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù† ÛŒØ§ Ù…ØªÙ† Ø±Ø§ Ø¯Ø³ØªÛŒ Ø¨Ù†ÙˆÛŒØ³."; };

    document.getElementById("recordBtn").onclick=()=>{
      hint.textContent="";
      rec.lang=s.value;
      try{ rec.start(); }catch(_){}
    };
  }else{
    document.getElementById("recordBtn").onclick=()=>{ hint.textContent="ØªØ´Ø®ÛŒØµ ØµØ¯Ø§ Ø¯Ø± Ø§ÛŒÙ† Ù…Ø±ÙˆØ±Ú¯Ø± Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯."; };
  }

  if("serviceWorker"in navigator) navigator.serviceWorker.register("service-worker.js");

  // If your GitHub Pages shows old version, do a hard refresh / clear cache.
</script>
</body>
</html>




