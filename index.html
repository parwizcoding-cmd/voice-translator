<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Voice Translator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#0B1220">

<style>
body{
  margin:0;
  font-family:Tahoma,Arial;
  background:#0B1220;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}
.app{
  width:100%;
  max-width:420px;
  background:#121a2f;
  padding:20px;
  border-radius:16px;
}
h1{text-align:center;margin:0 0 10px}
select,textarea,button{
  width:100%;
  margin-top:8px;
  padding:10px;
  border-radius:10px;
  border:none;
  font-size:14px;
}
textarea{min-height:70px}
button{cursor:pointer;font-weight:bold}
.primary{background:#7c3aed;color:#000}
.secondary{background:#222}
.danger{background:#b91c1c}
.box{
  background:#0f172a;
  padding:10px;
  border-radius:10px;
  margin-top:8px;
  min-height:40px;
  text-align:center;
}
.row{display:flex;gap:8px;margin-top:8px}
.row button{flex:1}
.hint{font-size:12px;color:#aaa;margin-top:8px;text-align:center}
</style>
</head>

<body>
<div class="app">
<h1>PZ Voice Translator</h1>

<select id="sourceLang">
  <option value="fa-IR">ÙØ§Ø±Ø³ÛŒ</option>
  <option value="en-US">English</option>
</select>

<select id="targetLang">
  <option value="en">English</option>
  <option value="fa">ÙØ§Ø±Ø³ÛŒ</option>
</select>

<div class="box" id="original">Ù…ØªÙ† ÙˆØ±ÙˆØ¯ÛŒâ€¦</div>
<div class="box" id="translated">ØªØ±Ø¬Ù…Ù‡â€¦</div>

<textarea id="input" placeholder="ØµØ­Ø¨Øª Ú©Ù† ÛŒØ§ Ø¨Ù†ÙˆÛŒØ³â€¦"></textarea>

<div class="row">
  <button id="record" class="primary">ğŸ™ ØµØ­Ø¨Øª</button>
  <button id="translate" class="secondary">ØªØ±Ø¬Ù…Ù‡</button>
</div>

<div class="row">
  <button id="play" class="secondary" disabled>ğŸ”Š Ù¾Ø®Ø´</button>
  <button id="clear" class="danger">Ù¾Ø§Ú©</button>
</div>

<div class="hint" id="hint"></div>
</div>

<script>
/* === Safe JS === */
const sourceLang = document.getElementById("sourceLang");
const targetLang = document.getElementById("targetLang");
const input = document.getElementById("input");
const original = document.getElementById("original");
const translated = document.getElementById("translated");
const hint = document.getElementById("hint");
const playBtn = document.getElementById("play");

let last = "";

/* Translate */
async function translateText(text){
  const url = "https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl="
    + targetLang.value + "&dt=t&q=" + encodeURIComponent(text);
  const r = await fetch(url);
  const j = await r.json();
  return j[0][0][0];
}

/* Speech Recognition */
const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
let rec = null;

if(SR){
  rec = new SR();
  rec.lang = sourceLang.value;
  rec.onresult = async e=>{
    const text = e.results[0][0].transcript;
    input.value = text;
    original.textContent = text;
    hint.textContent = "Ø¯Ø± Ø­Ø§Ù„ ØªØ±Ø¬Ù…Ù‡â€¦";
    try{
      const out = await translateText(text);
      translated.textContent = out;
      last = out;
      playBtn.disabled = false;
      hint.textContent = "";
    }catch{
      hint.textContent = "Ø®Ø·Ø§ Ø¯Ø± ØªØ±Ø¬Ù…Ù‡";
    }
  };
}else{
  hint.textContent = "ØªØ´Ø®ÛŒØµ ØµØ¯Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯";
}

/* Buttons */
document.getElementById("record").onclick = ()=>{
  if(!rec){hint.textContent="ØªØ´Ø®ÛŒØµ ØµØ¯Ø§ Ù†ÛŒØ³Øª";return}
  rec.lang = sourceLang.value;
  rec.start();
};

document.getElementById("translate").onclick = async ()=>{
  if(!input.value.trim()) return;
  original.textContent = input.value;
  const out = await translateText(input.value);
  translated.textContent = out;
  last = out;
  playBtn.disabled = false;
};

document.getElementById("play").onclick = ()=>{
  const u = new SpeechSynthesisUtterance(last);
  u.lang = targetLang.value === "fa" ? "fa-IR" : "en-US";
  speechSynthesis.speak(u);
};

document.getElementById("clear").onclick = ()=>{
  input.value="";
  original.textContent="Ù…ØªÙ† ÙˆØ±ÙˆØ¯ÛŒâ€¦";
  translated.textContent="ØªØ±Ø¬Ù…Ù‡â€¦";
  last="";
  playBtn.disabled=true;
  hint.textContent="";
};
</script>
</body>
</html>
