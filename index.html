<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Voice Translator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#0B1220">
<link rel="manifest" href="manifest.json">

<style>
:root{
  --bg1:#0B1220;--bg2:#0E1B2E;
  --card:rgba(255,255,255,.06);
  --stroke:rgba(255,255,255,.14);
  --text:rgba(255,255,255,.92);
  --muted:rgba(255,255,255,.7);
  --accent:#7C3AED;--danger:#EF4444;
}
*{box-sizing:border-box}
body{
  margin:0;font-family:Segoe UI,Tahoma;
  background:linear-gradient(135deg,var(--bg1),var(--bg2));
  color:var(--text);
  min-height:100vh;
  display:flex;align-items:center;justify-content:center;
  padding:16px;
}
.card{
  width:100%;max-width:560px;
  background:var(--card);
  border:1px solid var(--stroke);
  border-radius:22px;
  padding:22px;
  box-shadow:0 25px 60px rgba(0,0,0,.45);
}
.topbar{
  direction:ltr;
  display:grid;
  grid-template-columns:auto 1fr auto;
  align-items:center;
  margin-bottom:10px;
}
.logo{
  font-size:30px;font-weight:900;
  background:linear-gradient(135deg,#7C3AED,#22C55E);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
h1{margin:0;text-align:center;direction:rtl}

.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
label{font-size:12px;color:var(--muted)}

select,textarea,button{
  width:100%;padding:12px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(16,23,40,.7);
  color:var(--text);font-size:15px;
}

textarea{margin-top:10px;min-height:90px;text-align:center}

.boxes{display:grid;gap:10px;margin-top:12px}
.box{
  min-height:60px;border-radius:16px;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.12);
  display:flex;align-items:center;justify-content:center;
  padding:12px;text-align:center
}

.btnRow{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
button{font-weight:700;cursor:pointer}
.primary{background:linear-gradient(135deg,var(--accent),#A78BFA);color:#000}
.secondary{background:rgba(255,255,255,.08)}
.danger{background:rgba(239,68,68,.2)}

button:disabled{opacity:.5}

.hint{margin-top:10px;font-size:12px;color:var(--muted);min-height:18px}

@media(max-width:420px){
  .grid,.btnRow{grid-template-columns:1fr}
}
</style>
</head>
<body>

<div class="card">
  <div class="topbar">
    <div class="logo">PZ</div>
    <h1>Voice Translator</h1>
    <div></div>
  </div>

  <div class="grid">
    <div>
      <label>Ø²Ø¨Ø§Ù† ÙˆØ±ÙˆØ¯ÛŒ</label>
      <select id="sourceLang"></select>
    </div>
    <div>
      <label>Ø²Ø¨Ø§Ù† Ù…Ù‚ØµØ¯</label>
      <select id="targetLang"></select>
    </div>
  </div>

  <div class="boxes">
    <div class="box" id="original">Ù…ØªÙ† ÙˆØ±ÙˆØ¯ÛŒâ€¦</div>
    <div class="box" id="translated">ØªØ±Ø¬Ù…Ù‡â€¦</div>
  </div>

  <textarea id="input" placeholder="Ù…ØªÙ† Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ ÛŒØ§ ØµØ­Ø¨Øª Ú©Ù†â€¦"></textarea>

  <div class="btnRow">
    <button id="record" class="primary">ğŸ™ Ø´Ø±ÙˆØ¹ ØµØ­Ø¨Øª</button>
    <button id="translate" class="secondary">ğŸ” ØªØ±Ø¬Ù…Ù‡ Ù…ØªÙ†</button>
  </div>

  <div class="btnRow">
    <button id="play" class="secondary" disabled>ğŸ”Š Ù¾Ø®Ø´ ØªØ±Ø¬Ù…Ù‡</button>
    <button id="clear" class="danger">ğŸ§¹ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†</button>
  </div>

  <div class="hint" id="hint"></div>
</div>

<script>
/* ---------- Language list ---------- */
const LANGS=[
 {n:"ÙØ§Ø±Ø³ÛŒ",sl:"fa-IR",tl:"fa",rtl:true},
 {n:"English",sl:"en-US",tl:"en"},
 {n:"FranÃ§ais",sl:"fr-FR",tl:"fr"},
 {n:"Deutsch",sl:"de-DE",tl:"de"},
 {n:"Î•Î»Î»Î·Î½Î¹ÎºÎ¬",sl:"el-GR",tl:"el"},
 {n:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",sl:"ar-SA",tl:"ar",rtl:true},
 {n:"TÃ¼rkÃ§e",sl:"tr-TR",tl:"tr"},
 {n:"Ğ ÑƒÑÑĞºĞ¸Ğ¹",sl:"ru-RU",tl:"ru"}
];

const sLang=sourceLang,tLang=targetLang;
LANGS.forEach(l=>{
  sLang.add(new Option(l.n,l.sl));
  tLang.add(new Option(l.n,l.tl));
});
sLang.value="fa-IR";tLang.value="en";

/* ---------- Translate ---------- */
async function translateText(text){
  const res=await fetch(
    `https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${tLang.value}&dt=t&q=${encodeURIComponent(text)}`
  );
  const j=await res.json();
  return j[0][0][0];
}

/* ---------- Speech ---------- */
let recognition=null;
const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
if(SR){
  recognition=new SR();
  recognition.continuous=false;
  recognition.interimResults=false;

  recognition.onresult=async(e)=>{
    const text=e.results[0][0].transcript;
    input.value=text;
    original.textContent=text;

    hint.textContent="Ø¯Ø± Ø­Ø§Ù„ ØªØ±Ø¬Ù…Ù‡â€¦";
    const out=await translateText(text);
    translated.textContent=out;
    last=out;
    play.disabled=false;

    if(!/iPhone|iPad|iPod/.test(navigator.userAgent)){
      speak(out);
    }else{
      hint.textContent="Ø¨Ø±Ø§ÛŒ ØµØ¯Ø§ Ø±ÙˆÛŒ Ù¾Ø®Ø´ Ø¨Ø²Ù†";
    }
  };

  recognition.onerror=()=>{
    hint.textContent="ØªØ´Ø®ÛŒØµ ØµØ¯Ø§ Ú©Ø§Ø± Ù†Ú©Ø±Ø¯";
  };
}

/* ---------- Speak ---------- */
function speak(text){
  speechSynthesis.cancel();
  const u=new SpeechSynthesisUtterance(text);
  u.lang=tLang.value;
  speechSynthesis.speak(u);
}

/* ---------- Buttons ---------- */
let last="";

record.onclick=()=>{
  if(!recognition){
    hint.textContent="ØªØ´Ø®ÛŒØµ ØµØ¯Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯";
    return;
  }
  hint.textContent="Ø¯Ø± Ø­Ø§Ù„ Ú¯ÙˆØ´ Ø¯Ø§Ø¯Ù†â€¦";
  recognition.lang=sLang.value;
  recognition.start();
};

translate.onclick=async()=>{
  if(!input.value.trim()){hint.textContent="Ù…ØªÙ† ÙˆØ§Ø±Ø¯ Ú©Ù†";return}
  original.textContent=input.value;
  const out=await translateText(input.value);
  translated.textContent=out;
  last=out;
  play.disabled=false;
};

play.onclick=()=>speak(last);

clear.onclick=()=>{
  speechSynthesis.cancel();
  input.value="";
  original.textContent="Ù…ØªÙ† ÙˆØ±ÙˆØ¯ÛŒâ€¦";
  translated.textContent="ØªØ±Ø¬Ù…Ù‡â€¦";
  last="";
  play.disabled=true;
  hint.textContent="";
};

if("serviceWorker"in navigator){
  navigator.serviceWorker.register("service-worker.js");
}
</script>
</body>
</html>
