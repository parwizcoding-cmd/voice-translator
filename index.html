<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>Voice Translator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#0B1220">
<link rel="manifest" href="manifest.json">

<style>
body{
  margin:0;
  font-family:tahoma;
  background:#0B1220;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}
.card{
  background:#111827;
  padding:20px;
  border-radius:20px;
  width:100%;
  max-width:520px;
  text-align:center;
}
select,textarea,button{
  width:100%;
  margin-top:8px;
  padding:12px;
  border-radius:12px;
  border:none;
  font-size:15px;
}
textarea{min-height:80px}
.btnRow{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
  margin-top:10px;
}
.primary{background:#7C3AED;color:#fff}
.secondary{background:#1F2937;color:#fff}
.danger{background:#7F1D1D;color:#fff}
.box{
  background:#1F2937;
  border-radius:12px;
  padding:10px;
  margin-top:8px;
  min-height:50px;
}
</style>
</head>

<body>
<div class="card">

<h2>Voice Translator</h2>

<select id="sourceLang">
  <option value="fa-IR">ÙØ§Ø±Ø³ÛŒ</option>
  <option value="en-US">English</option>
</select>

<select id="targetLang">
  <option value="en">English</option>
  <option value="fa">ÙØ§Ø±Ø³ÛŒ</option>
</select>

<div class="box" id="originalText">Ù…ØªÙ† ÙˆØ±ÙˆØ¯ÛŒâ€¦</div>
<div class="box" id="translatedText">ØªØ±Ø¬Ù…Ù‡â€¦</div>

<textarea id="manualInput" placeholder="Ù…ØªÙ† Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³â€¦"></textarea>

<div class="btnRow">
  <button id="recordBtn" class="primary">ğŸ™ Ø´Ø±ÙˆØ¹ ØµØ­Ø¨Øª</button>
  <button id="translateBtn" class="secondary">ğŸ” ØªØ±Ø¬Ù…Ù‡ Ù…ØªÙ†</button>
</div>

<div class="btnRow">
  <button id="playBtn" class="secondary" disabled>ğŸ”Š Ù¾Ø®Ø´ ØªØ±Ø¬Ù…Ù‡</button>
  <button id="clearBtn" class="danger">ğŸ—‘ Ø­Ø°Ù Ù…ØªÙ†</button>
</div>

<div id="hint" style="margin-top:10px;font-size:13px;color:#aaa"></div>

</div>

<script>
const sourceLang=document.getElementById("sourceLang");
const targetLang=document.getElementById("targetLang");
const originalText=document.getElementById("originalText");
const translatedText=document.getElementById("translatedText");
const manualInput=document.getElementById("manualInput");
const recordBtn=document.getElementById("recordBtn");
const translateBtn=document.getElementById("translateBtn");
const playBtn=document.getElementById("playBtn");
const clearBtn=document.getElementById("clearBtn");
const hint=document.getElementById("hint");

let lastTranslation="";

// translate
async function translateText(text){
  const r=await fetch(
    `https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${targetLang.value}&dt=t&q=${encodeURIComponent(text)}`
  );
  const j=await r.json();
  return j[0][0][0];
}

translateBtn.onclick=async()=>{
  if(!manualInput.value.trim()) return;
  originalText.textContent=manualInput.value;
  const out=await translateText(manualInput.value);
  translatedText.textContent=out;
  lastTranslation=out;
  playBtn.disabled=false;
};

// play
playBtn.onclick=()=>{
  speechSynthesis.cancel();
  const u=new SpeechSynthesisUtterance(lastTranslation);
  u.lang=targetLang.value;
  speechSynthesis.speak(u);
};

// clear
clearBtn.onclick=()=>{
  speechSynthesis.cancel();
  originalText.textContent="Ù…ØªÙ† ÙˆØ±ÙˆØ¯ÛŒâ€¦";
  translatedText.textContent="ØªØ±Ø¬Ù…Ù‡â€¦";
  manualInput.value="";
  lastTranslation="";
  playBtn.disabled=true;
  hint.textContent="";
};

// speech recognition
const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
if(SR){
  const rec=new SR();
  rec.continuous=false;
  rec.interimResults=false;

  recordBtn.onclick=()=>{
    rec.lang=sourceLang.value;
    rec.start();
  };

  rec.onresult=async(e)=>{
    const text=e.results[0][0].transcript;
    originalText.textContent=text;
    manualInput.value=text;
    const out=await translateText(text);
    translatedText.textContent=out;
    lastTranslation=out;
    playBtn.disabled=false;
  };
}else{
  hint.textContent="SpeechRecognition Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯";
}
</script>
</body>
</html>
