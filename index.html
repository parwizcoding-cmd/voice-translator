<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
    <meta charset="UTF-8" />
    <title>Voice Translator</title>

    <!-- Viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Theme -->
    <meta name="theme-color" content="#0B1220">

    <!-- âœ… PWA Manifest (Android) -->
    <link rel="manifest" href="manifest.json">

    <!-- âœ… iOS (iPhone / iPad) -->
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Voice Translator">

    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc =
            "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
    </script>


    <!-- OCR -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

    <style>
        :root {
            --bg1: #0B1220;
            --bg2: #0E1B2E;
            --card: rgba(255, 255, 255, .06);
            --stroke: rgba(255, 255, 255, .14);
            --text: rgba(255, 255, 255, .92);
            --muted: rgba(255, 255, 255, .7);
            --accent: #7C3AED;
            --danger: #EF4444;
        }

        * {
            box-sizing: border-box
        }

        body {
            margin: 0;
            font-family: "Segoe UI", Tahoma, sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 18px;
            color: var(--text);
            background:
                radial-gradient(900px 500px at 20% 15%, rgba(124, 58, 237, .35), transparent 55%),
                radial-gradient(900px 500px at 80% 20%, rgba(34, 197, 94, .25), transparent 55%),
                linear-gradient(135deg, var(--bg1), var(--bg2));
        }

        .wrap {
            width: 100%;
            max-width: 560px
        }

        .card {
            background: var(--card);
            border: 1px solid var(--stroke);
            border-radius: 22px;
            padding: 22px;
            box-shadow: 0 25px 60px rgba(0, 0, 0, .45);
            backdrop-filter: blur(10px);
            text-align: center;
        }

        .topbar {
            display: grid;
            grid-template-columns: auto 1fr auto;
            align-items: center;
            margin-bottom: 10px;
        }

        .logoLeft {
            font-size: 30px;
            font-weight: 900;
            background: linear-gradient(135deg, #7C3AED, #22C55E);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        h1 {
            margin: 0;
            font-size: 20px;
            font-weight: 800
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px
        }

        select,
        textarea,
        button {
            width: 100%;
            border-radius: 14px;
            border: 1px solid rgba(255, 255, 255, .12);
            background: rgba(16, 23, 40, .65);
            color: var(--text);
            padding: 12px;
            font-size: 15px;
        }

        textarea {
            margin-top: 10px;
            min-height: 90px;
            resize: vertical;
            text-align: center;
        }

        .box {
            margin-top: 12px;
            height: 90px;
            overflow-y: auto;
            border-radius: 16px;
            background: rgba(255, 255, 255, .06);
            border: 1px solid rgba(255, 255, 255, .12);
            padding: 12px;
            text-align: right;
            line-height: 1.6;
            word-break: break-word;

            display: flex;
            align-items: center;
            justify-content: center;

        }

        .btnRow {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 12px
        }

        button {
            cursor: pointer;
            font-weight: 700
        }

        .primary {
            background: linear-gradient(135deg, var(--accent), #A78BFA);
            color: #0B1220
        }

        .secondary {
            background: rgba(255, 255, 255, .06)
        }

        .danger {
            background: rgba(239, 68, 68, .18)
        }

        .hint {
            margin-top: 10px;
            font-size: 12px;
            color: var(--muted)
        }

        @media(max-width:420px) {

            .grid,
            .btnRow {
                grid-template-columns: 1fr
            }
        }
    </style>
</head>

<body>
    <div class="wrap">
        <div class="card">

            <div class="topbar">
                <div class="logoLeft">PZ</div>
                <h1>Voice Translator</h1>
                <div></div>
            </div>

            <div class="grid">
                <select id="sourceLang"></select>
                <select id="targetLang"></select>
            </div>

            <div class="box" id="translatedText">ØªØ±Ø¬Ù…Ù‡â€¦</div>

            <textarea id="manualInput" placeholder="Ù…ØªÙ† Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ù†ÙˆÛŒØ³â€¦"></textarea>

            <div class="btnRow">
                <button id="recordBtn" class="primary">ğŸ™ Ø´Ø±ÙˆØ¹ ØµØ­Ø¨Øª</button>
                <button id="translateBtn" class="secondary">ğŸ” ØªØ±Ø¬Ù…Ù‡ Ù…ØªÙ†</button>
            </div>

            <div class="btnRow">
                <button id="fileBtn" class="secondary">ğŸ“ Ø§ÙØ²ÙˆØ¯Ù† ÙØ§ÛŒÙ„ / Ø¯ÙˆØ±Ø¨ÛŒÙ†</button>
                <button id="stopVoiceBtn" class="secondary">â¹ ØªÙˆÙ‚Ù Ø®ÙˆØ§Ù†Ø¯Ù†</button>
            </div>

            <div class="btnRow">
                <button id="clearBtn" class="danger">ğŸ§¹ Ù¾Ø§Ú©â€ŒÚ©Ø±Ø¯Ù†</button>
            </div>

            <input type="file" id="fileInput" accept=".txt,.pdf,image/*" capture="environment" hidden>

            <div class="hint" id="hintText"></div>

        </div>
    </div>

    <script>
        /* ===== LANGUAGES (30) ===== */
        const LANGS = [
            { f: "ğŸ‡®ğŸ‡·", n: "ÙØ§Ø±Ø³ÛŒ", sl: "fa-IR", tl: "fa" },
            { f: "ğŸ‡ºğŸ‡¸", n: "English (US)", sl: "en-US", tl: "en" },
            { f: "ğŸ‡¬ğŸ‡§", n: "English (UK)", sl: "en-GB", tl: "en" },
            { f: "ğŸ‡¸ğŸ‡¦", n: "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©", sl: "ar-SA", tl: "ar" },
            { f: "ğŸ‡¹ğŸ‡·", n: "TÃ¼rkÃ§e", sl: "tr-TR", tl: "tr" },
            { f: "ğŸ‡©ğŸ‡ª", n: "Deutsch", sl: "de-DE", tl: "de" },
            { f: "ğŸ‡«ğŸ‡·", n: "FranÃ§ais", sl: "fr-FR", tl: "fr" },
            { f: "ğŸ‡ªğŸ‡¸", n: "EspaÃ±ol", sl: "es-ES", tl: "es" },
            { f: "ğŸ‡®ğŸ‡¹", n: "Italiano", sl: "it-IT", tl: "it" },
            { f: "ğŸ‡µğŸ‡¹", n: "PortuguÃªs", sl: "pt-PT", tl: "pt" },
            { f: "ğŸ‡§ğŸ‡·", n: "PortuguÃªs (BR)", sl: "pt-BR", tl: "pt" },
            { f: "ğŸ‡·ğŸ‡º", n: "Ğ ÑƒÑÑĞºĞ¸Ğ¹", sl: "ru-RU", tl: "ru" },
            { f: "ğŸ‡¨ğŸ‡³", n: "ä¸­æ–‡", sl: "zh-CN", tl: "zh-CN" },
            { f: "ğŸ‡¯ğŸ‡µ", n: "æ—¥æœ¬èª", sl: "ja-JP", tl: "ja" },
            { f: "ğŸ‡°ğŸ‡·", n: "í•œêµ­ì–´", sl: "ko-KR", tl: "ko" },
            { f: "ğŸ‡®ğŸ‡³", n: "à¤¹à¤¿à¤¨à¥à¤¦à¥€", sl: "hi-IN", tl: "hi" },
            { f: "ğŸ‡µğŸ‡°", n: "Ø§Ø±Ø¯Ùˆ", sl: "ur-PK", tl: "ur" },
            { f: "ğŸ‡¦ğŸ‡«", n: "Ù¾Ø´ØªÙˆ", sl: "ps-AF", tl: "ps" },
            { f: "ğŸ‡¬ğŸ‡·", n: "Î•Î»Î»Î·Î½Î¹ÎºÎ¬", sl: "el-GR", tl: "el" },
            { f: "ğŸ‡³ğŸ‡±", n: "Nederlands", sl: "nl-NL", tl: "nl" },
            { f: "ğŸ‡¸ğŸ‡ª", n: "Svenska", sl: "sv-SE", tl: "sv" },
            { f: "ğŸ‡µğŸ‡±", n: "Polski", sl: "pl-PL", tl: "pl" },
            { f: "ğŸ‡¹ğŸ‡­", n: "à¹„à¸—à¸¢", sl: "th-TH", tl: "th" },
            { f: "ğŸ‡»ğŸ‡³", n: "Tiáº¿ng Viá»‡t", sl: "vi-VN", tl: "vi" },
            { f: "ğŸ‡®ğŸ‡©", n: "Bahasa Indonesia", sl: "id-ID", tl: "id" },
            { f: "ğŸ‡²ğŸ‡¾", n: "Bahasa Melayu", sl: "ms-MY", tl: "ms" },
            { f: "ğŸ‡ºğŸ‡¦", n: "Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°", sl: "uk-UA", tl: "uk" },
            { f: "ğŸ‡®ğŸ‡±", n: "×¢×‘×¨×™×ª", sl: "he-IL", tl: "he" },
            { f: "ğŸ‡·ğŸ‡´", n: "RomÃ¢nÄƒ", sl: "ro-RO", tl: "ro" },
            { f: "ğŸ‡¨ğŸ‡¿", n: "ÄŒeÅ¡tina", sl: "cs-CZ", tl: "cs" }
        ];

        const s = sourceLang, t = targetLang;
        const m = manualInput, tr = translatedText;
        LANGS.forEach(l => {
            s.add(new Option(`${l.f} ${l.n}`, l.sl));
            t.add(new Option(`${l.f} ${l.n}`, l.tl));
        });
        s.value = "fa-IR"; t.value = "en";

        /* ===== SPEAK CONTROL ===== */
        let allowSpeak = true;

        /* ===== TRANSLATE ===== */
        async function translateText(text, tl) {
            const r = await fetch(
                `https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${tl}&dt=t&q=${encodeURIComponent(text)}`
            );
            const j = await r.json();
            return j?.[0]?.[0]?.[0] || "";
        }
        function speak(text, lang) {
            if (!allowSpeak) return;
            try { speechSynthesis.cancel() } catch (e) { }
            const u = new SpeechSynthesisUtterance(text);
            u.lang = lang;
            speechSynthesis.speak(u);
        }
        async function runTranslate(text) {
            if (!text.trim()) return;
            tr.textContent = "â³ Ø¯Ø± Ø­Ø§Ù„ ØªØ±Ø¬Ù…Ù‡...";
            const out = await translateText(text, t.value);
            tr.textContent = out;
            speak(out, t.value);
        }

        /* ===== BUTTONS ===== */
        translateBtn.onclick = () => {
            allowSpeak = true;
            runTranslate(m.value);
        };
        stopVoiceBtn.onclick = () => {
            allowSpeak = false;
            try { speechSynthesis.cancel() } catch (e) { }
        };

        /* ===== VOICE ===== */
        const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (SR) {
            const rec = new SR();
            rec.onresult = e => {
                allowSpeak = true;
                m.value = e.results[0][0].transcript;
                runTranslate(m.value);
            };
            recordBtn.onclick = () => {
                rec.lang = s.value;
                rec.start();
            };
        }

        /* ===== FILE / CAMERA / OCR ===== */
        fileBtn.onclick = () => fileInput.click();

        fileInput.onchange = async () => {
            const file = fileInput.files[0];
            if (!file) return;
            allowSpeak = true;

            // IMAGE OCR (Camera + Auto Language)
            if (file.type.startsWith("image/")) {
                tr.textContent = "ğŸ“· OCR Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´...";
                const res = await Tesseract.recognize(
                    file,
                    "eng+fas+ara+urd+ps+fra+deu+spa+ita+por+rus+tur+ell",
                    {
                        logger: m => {
                            if (m.status === "recognizing text") {
                                tr.textContent = `ğŸ“· OCR: ${Math.round(m.progress * 100)}Ùª`;
                            }
                        }
                    }
                );
                const text = res.data.text.trim();
                if (text) {
                    m.value = text;
                    runTranslate(text);
                } else tr.textContent = "âŒ Ù…ØªÙ†ÛŒ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯";
            }

            // PDF
            else if (file.type === "application/pdf") {
                tr.textContent = "ğŸ“„ Ø¯Ø± Ø­Ø§Ù„ Ø®ÙˆØ§Ù†Ø¯Ù† PDF...";
                const r = new FileReader();
                r.onload = async () => {
                    const pdf = await pdfjsLib.getDocument({ data: new Uint8Array(r.result) }).promise;
                    let text = "";
                    for (let i = 1; i <= pdf.numPages; i++) {
                        const p = await pdf.getPage(i);
                        const c = await p.getTextContent();
                        c.items.forEach(it => text += it.str + " ");
                    }
                    m.value = text;
                    runTranslate(text);
                };
                r.readAsArrayBuffer(file);
            }

            // TXT
            else {
                const r = new FileReader();
                r.onload = e => {
                    m.value = e.target.result;
                    runTranslate(m.value);
                };
                r.readAsText(file);
            }
        };

        /* ===== CLEAR ===== */
        clearBtn.onclick = () => {
            m.value = "";
            tr.textContent = "ØªØ±Ø¬Ù…Ù‡â€¦";
            allowSpeak = true;
        };
    </script>

</body>

</html>
