<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Voice Translator</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#00E676">

  <link rel="manifest" href="manifest.json">

  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", Tahoma, sans-serif;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: #fff;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .card {
      background: #121212;
      border-radius: 20px;
      padding: 25px;
      width: 100%;
      max-width: 420px;
      box-shadow: 0 20px 40px rgba(0,0,0,.5);
      text-align: center;
    }

    h1 {
      margin-top: 0;
      color: #00E676;
      font-size: 26px;
    }

    select, button {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border-radius: 12px;
      border: none;
      font-size: 16px;
    }

    select {
      background: #1e1e1e;
      color: #fff;
    }

    button {
      background: #00E676;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      transition: transform .15s ease;
    }

    button:active {
      transform: scale(0.97);
    }

    .box {
      background: #1e1e1e;
      border-radius: 12px;
      padding: 12px;
      margin-top: 12px;
      min-height: 60px;
      direction: rtl;
    }

    footer {
      margin-top: 15px;
      font-size: 12px;
      opacity: .7;
    }
  </style>
</head>
<body>

  <div class="card">
    <h1>ğŸ¤ Ù…ØªØ±Ø¬Ù… ØµÙˆØªÛŒ</h1>

    <select id="sourceLang">
      <option value="fa-IR">ÙØ§Ø±Ø³ÛŒ</option>
      <option value="en-US">English</option>
      <option value="de-DE">Deutsch</option>
      <option value="tr-TR">TÃ¼rkÃ§e</option>
      <option value="ar-SA">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
    </select>

    <select id="targetLang">
      <option value="en">English</option>
      <option value="fa">ÙØ§Ø±Ø³ÛŒ</option>
      <option value="de">Deutsch</option>
      <option value="tr">TÃ¼rkÃ§e</option>
      <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
    </select>

    <button id="recordBtn">ğŸ™ Ø´Ø±ÙˆØ¹ ØµØ­Ø¨Øª</button>

    <div class="box" id="originalText">Ù…ØªÙ† ÙˆØ±ÙˆØ¯ÛŒâ€¦</div>
    <div class="box" id="translatedText">ØªØ±Ø¬Ù…Ù‡â€¦</div>

    <footer>Voice Translator PWA</footer>
  </div>

<script>
let recognition;
let userInteracted = false;

if ('webkitSpeechRecognition' in window) {
  recognition = new webkitSpeechRecognition();
  recognition.continuous = false;
  recognition.interimResults = false;
} else {
  alert("Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ ØªØ´Ø®ÛŒØµ ØµØ¯Ø§ Ø±Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯");
}

document.getElementById("recordBtn").onclick = () => {
  userInteracted = true;
  const src = document.getElementById("sourceLang").value;
  recognition.lang = src;
  recognition.start();
};

recognition.onresult = async (event) => {
  const text = event.results[0][0].transcript;
  document.getElementById("originalText").innerText = text;

  const target = document.getElementById("targetLang").value;
  const translated = await translateText(text, target);

  document.getElementById("translatedText").innerText = translated;
  speak(translated, target);
};

async function translateText(text, target) {
  const res = await fetch(
    "https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=" +
      target +
      "&dt=t&q=" +
      encodeURIComponent(text)
  );
  const data = await res.json();
  return data[0][0][0];
}

function speak(text, lang) {
  if (!userInteracted) return;

  speechSynthesis.cancel();
  const utter = new SpeechSynthesisUtterance(text);

  const map = {
    fa: "fa-IR",
    en: "en-US",
    de: "de-DE",
    tr: "tr-TR",
    ar: "ar-SA"
  };

  utter.lang = map[lang] || lang;
  speechSynthesis.speak(utter);
}

// Service Worker
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}
</script>
</body>
</html>
